<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ²™æ¼ ç»¿åŒ–è€…Pro - ç”Ÿæ€æ¨¡æ‹Ÿæ¸¸æˆ</title>
    <style>
        :root {
            --sand-color: #E6D5B8;
            --plant-green: #5DBE7E;
            --water-blue: #6EC3E0;
            --danger-red: #FF6B6B;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: url('ç´ æå›¾ç‰‡3.jpg') no-repeat center center fixed;
            background-size: cover;
            text-align: center;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(245, 249, 245, 0.85);
            z-index: -1;
        }
        
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .game-rules {
            background: #f0f7f0;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: left;
        }
        
        .game-rules h3 {
            margin-top: 0;
            color: #2E8B57;
        }
        
        .game-rules ul {
            padding-left: 20px;
        }
        
        .game-area {
            width: 100%;
            height: 400px;
            background-color: var(--sand-color);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            margin: 15px 0;
            background-image: radial-gradient(circle, transparent 10%, rgba(0,0,0,0.05) 10%);
            background-size: 20px 20px;
            transition: background 1s;
        }
        
        .tree {
            width: 30px;
            height: 45px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 45"><path d="M15 0 Q25 15 15 30 Q5 15 15 0" fill="%235DBE7E"/></svg>');
            position: absolute;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 2;
        }
        
        .tree.mature {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 45"><path d="M15 0 Q25 18 15 36 Q5 18 15 0" fill="%232E8B57"/></svg>');
        }
        
        .tree.super {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 60"><path d="M15 0 Q25 15 15 45 Q5 15 15 0" fill="%23005F40"/></svg>');
            height: 60px;
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from { filter: drop-shadow(0 0 2px #5DBE7E); }
            to { filter: drop-shadow(0 0 6px #5DBE7E); }
        }
        
        .weather {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3;
            opacity: 0;
            transition: opacity 1s;
        }
        
        .rain {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="2" height="20" viewBox="0 0 2 20"><line x1="1" y1="0" x2="1" y2="20" stroke="%236EC3E0" stroke-width="1"/></svg>');
            animation: rain 0.5s linear infinite;
        }
        
        @keyframes rain {
            to { background-position: 0 20px; }
        }
        
        .sandstorm {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><circle cx="10" cy="10" r="3" fill="%23E6D5B8" opacity="0.5"/></svg>');
            animation: sandstorm 2s linear infinite;
        }
        
        @keyframes sandstorm {
            to { background-position: 20px 20px; }
        }
        
        .animal {
            position: absolute;
            width: 30px;
            height: 30px;
            z-index: 1;
            transition: all 0.5s;
        }
        
        .bird {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30"><path d="M30 15 Q20 5 10 15 Q20 25 30 15" fill="%23333"/></svg>');
            animation: fly 10s linear infinite;
        }
        
        @keyframes fly {
            0% { transform: translateX(-30px) translateY(10px); }
            100% { transform: translateX(830px) translateY(20px); }
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            background-color: #5DBE7E;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            min-width: 120px;
        }
        
        button:hover {
            background-color: #2E8B57;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        button.special {
            background-color: #6EC3E0;
        }
        
        button.special:hover {
            background-color: #3A9ECB;
        }
        
        button.danger {
            background-color: var(--danger-red);
        }
        
        button.danger:hover {
            background-color: #E05555;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            background: #f0f7f0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 5px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2E8B57;
        }
        
        .progress-container {
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #5DBE7E, #2E8B57);
            width: 0%;
            transition: width 0.5s;
        }
        
        .event-log {
            height: 80px;
            overflow-y: auto;
            text-align: left;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .log-entry {
            margin: 3px 0;
            padding: 2px 5px;
            border-left: 3px solid #5DBE7E;
        }
        
        .log-entry.warning {
            border-left-color: orange;
        }
        
        .log-entry.danger {
            border-left-color: var(--danger-red);
        }
        
        .back-btn {
            display: inline-block;
            margin-top: 20px;
            padding: 8px 16px;
            background: #5DBE7E;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: all 0.2s;
        }
        
        .back-btn:hover {
            background: #2E8B57;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            z-index: 10;
            transform: translateY(-100%);
            opacity: 0;
            transition: opacity 0.3s;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>æ²™æ¼ ç»¿åŒ–è€…Pro</h1>
        <p>é€šè¿‡ç§æ¤æ¢­æ¢­æ ‘æ¢å¤æ²™æ¼ ç”Ÿæ€ï¼Œåº”å¯¹å„ç§æŒ‘æˆ˜ï¼</p>
        
        <div class="game-rules">
            <h3>æ¸¸æˆè§„åˆ™ï¼š</h3>
            <ul>
                <li><strong>ç§æ¤æ ‘æœ¨</strong>ï¼šç‚¹å‡»"ç§æ¤æ¢­æ¢­æ ‘"æŒ‰é’®åœ¨æ²™æ¼ ä¸­ç§æ¤æ ‘æœ¨</li>
                <li><strong>åŸ¹è‚²æ ‘æœ¨</strong>ï¼šç‚¹å‡»æ ‘è‹—ä½¿å…¶æˆç†Ÿï¼Œæˆç†Ÿæ ‘æœ¨å¯æä¾›æ›´å¤šç”Ÿæ€åˆ†</li>
                <li><strong>æµ‡æ°´æ–½è‚¥</strong>ï¼šä½¿ç”¨æ°´å’Œè‚¥æ–™åŠ é€Ÿæ ‘æœ¨ç”Ÿé•¿ï¼Œè‚¥æ–™å¯ä½¿æˆç†Ÿæ ‘æœ¨è¿›åŒ–ä¸ºè¶…çº§æ¢­æ¢­</li>
                <li><strong>å‡çº§å·¥å…·</strong>ï¼šç§¯ç´¯30åˆ†å¯å‡çº§å·¥å…·ï¼Œæé«˜ç§æ¤ä¸Šé™å’Œæµ‡æ°´æ¬¡æ•°</li>
                <li><strong>åº”å¯¹å¤©æ°”</strong>ï¼šéšæœºå¤©æ°”ä¼šå½±å“æ¸¸æˆï¼Œä¸‹é›¨æœ‰åˆ©ï¼Œæ²™å°˜æš´æœ‰å®³</li>
                <li><strong>ç›®æ ‡</strong>ï¼šå°½å¯èƒ½åˆ›é€ æ›´å¤šè¶…çº§æ¢­æ¢­ï¼Œæé«˜ç”Ÿæ€åˆ†æ•°</li>
            </ul>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="tree-count">0</div>
                <div>å·²ç§æ¤æ ‘æœ¨</div>
                <div class="progress-container">
                    <div class="progress-bar" id="tree-progress"></div>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="eco-score">0</div>
                <div>ç”Ÿæ€æŒ‡æ•°</div>
                <div class="progress-container">
                    <div class="progress-bar" id="eco-progress"></div>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="water-count">10</div>
                <div>å‰©ä½™æµ‡æ°´</div>
                <div class="progress-container">
                    <div class="progress-bar" id="water-progress"></div>
                </div>
            </div>
        </div>
        
        <div class="game-area" id="gameArea">
            <div class="weather rain" id="rainEffect"></div>
            <div class="weather sandstorm" id="sandstormEffect"></div>
        </div>
        
        <div class="event-log" id="eventLog">
            <div class="log-entry">æ¸¸æˆå¼€å§‹ï¼å°è¯•ç§æ¤ç¬¬ä¸€æ£µæ¢­æ¢­æ ‘</div>
        </div>
        
        <div class="controls">
            <button id="plantBtn">ç§æ¤æ¢­æ¢­æ ‘</button>
            <button id="waterBtn" class="special">æµ‡æ°´ (å‰©ä½™: <span id="water-text">10</span>)</button>
            <button id="fertilizeBtn" class="special">æ–½è‚¥ (å‰©ä½™: <span id="fertilize-text">5</span>)</button>
            <button id="upgradeBtn">å‡çº§å·¥å…· (30åˆ†)</button>
            <button id="resetBtn" class="danger">é‡æ–°å¼€å§‹</button>
        </div>
        <button onclick="window.location.href=''" 
            style="padding: 10px 20px; background-color: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
        END
    </button>
</div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const state = {
            trees: 0,
            score: 0,
            water: 10,  // å¢åŠ åˆå§‹æµ‡æ°´æ¬¡æ•°
            fertilizer: 5,  // å¢åŠ åˆå§‹è‚¥æ–™æ•°é‡
            maxTrees: 30,  // å¢åŠ æœ€å¤§æ ‘æœ¨æ•°é‡
            toolLevel: 1,
            cooldowns: {
                planting: false,
                watering: false
            },
            weather: 'sunny',
            weatherTimer: null,
            resourceTimer: null
        };

        // DOMå…ƒç´ 
        const gameArea = document.getElementById('gameArea');
        const treeCountEl = document.getElementById('tree-count');
        const ecoScoreEl = document.getElementById('eco-score');
        const waterCountEl = document.getElementById('water-count');
        const plantBtn = document.getElementById('plantBtn');
        const waterBtn = document.getElementById('waterBtn');
        const fertilizeBtn = document.getElementById('fertilizeBtn');
        const upgradeBtn = document.getElementById('upgradeBtn');
        const resetBtn = document.getElementById('resetBtn');
        const eventLog = document.getElementById('eventLog');
        const tooltip = document.getElementById('tooltip');
        const rainEffect = document.getElementById('rainEffect');
        const sandstormEffect = document.getElementById('sandstormEffect');

        // ç§æ¤æ ‘æœ¨
        plantBtn.addEventListener('click', () => {
            if (state.cooldowns.planting) return;
            
            if (state.trees >= state.maxTrees) {
                addLog(`âŒ å·²è¾¾åˆ°æœ€å¤§ç§æ¤æ•°é‡ ${state.maxTrees} æ£µï¼`, 'warning');
                return;
            }

            state.cooldowns.planting = true;
            plantBtn.disabled = true;
            
            setTimeout(() => {
                state.cooldowns.planting = false;
                plantBtn.disabled = false;
                actuallyPlantTree();
            }, 100);
        });

        function actuallyPlantTree() {
            const tree = document.createElement('div');
            tree.className = 'tree';
            
            const x = Math.random() * (gameArea.offsetWidth - 30);
            const y = Math.random() * (gameArea.offsetHeight - 45);
            
            tree.style.left = `${x}px`;
            tree.style.top = `${y}px`;
            
            tree.addEventListener('click', function() {
                if (this.classList.contains('super')) return;
                
                if (!this.classList.contains('mature')) {
                    this.classList.add('mature');
                    state.score += 3;  // ä»2å¢åŠ åˆ°3
                    addLog("ğŸŒ± æ ‘æœ¨æˆç†Ÿäº†ï¼+3ç”Ÿæ€åˆ†");
                    updateGame();
                } else if (state.fertilizer > 0 && Math.random() > 0.3) {  // æˆåŠŸç‡ä»0.5æé«˜åˆ°0.7
                    this.classList.add('super');
                    state.score += 8;  // ä»5å¢åŠ åˆ°8
                    addLog("âœ¨ æ ‘æœ¨è¿›åŒ–ä¸ºè¶…çº§æ¢­æ¢­ï¼+8ç”Ÿæ€åˆ†");
                    updateGame();
                }
            });

            tree.addEventListener('mousemove', (e) => {
                const status = tree.classList.contains('super') ? 'è¶…çº§æ¢­æ¢­' : 
                              tree.classList.contains('mature') ? 'æˆç†Ÿæ ‘æœ¨' : 'æ ‘è‹—';
                showTooltip(e, status);
            });
            
            tree.addEventListener('mouseout', hideTooltip);

            gameArea.appendChild(tree);
            state.trees++;
            
            // 10%å‡ ç‡è·å¾—é¢å¤–èµ„æº
            if (Math.random() > 0.9) {
                state.water++;
                state.fertilizer++;
                addLog("ğŸ å¹¸è¿ï¼è·å¾—é¢å¤–æ°´å’Œè‚¥æ–™", 'warning');
            }
            
            addLog("ğŸŒµ ç§æ¤äº†æ–°çš„æ¢­æ¢­æ ‘");
            updateGame();
            
            if (Math.random() > 0.9 && state.score > 10) {
                spawnBird();
            }
        }

        // æµ‡æ°´åŠŸèƒ½
        waterBtn.addEventListener('click', () => {
            if (state.cooldowns.watering || state.water <= 0) return;
            
            state.cooldowns.watering = true;
            waterBtn.disabled = true;
            
            rainEffect.style.opacity = '0.3';
            setTimeout(() => {
                rainEffect.style.opacity = '0';
            }, 1000);
            
            setTimeout(() => {
                state.cooldowns.watering = false;
                waterBtn.disabled = false;
            }, 2000);

            state.water--;
            const trees = document.querySelectorAll('.tree:not(.super)');
            
            if (trees.length === 0) {
                addLog("ğŸ’§ æµ‡æ°´äº†ï¼Œä½†æ²¡æœ‰æ ‘æœ¨å¯ä»¥å—ç›Š", 'warning');
                updateGame();
                return;
            }
            
            trees.forEach(tree => {
                tree.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    tree.style.transform = 'scale(1)';
                }, 300);

                if (Math.random() > 0.6 && !tree.classList.contains('mature')) {
                    tree.classList.add('mature');
                    state.score += 1;
                }
            });

            addLog(`ğŸ’§ æµ‡çŒäº† ${trees.length} æ£µæ ‘æœ¨`);
            updateGame();
        });

        // æ–½è‚¥åŠŸèƒ½
        fertilizeBtn.addEventListener('click', () => {
            if (state.fertilizer <= 0) {
                addLog("âŒ æ²¡æœ‰å‰©ä½™è‚¥æ–™äº†ï¼", 'warning');
                return;
            }
            
            const trees = document.querySelectorAll('.tree.mature:not(.super)');
            if (trees.length === 0) {
                addLog("âŒ æ²¡æœ‰å¯ä»¥æ–½è‚¥çš„æˆç†Ÿæ ‘æœ¨", 'warning');
                return;
            }
            
            state.fertilizer--;
            
            const shuffled = Array.from(trees).sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, 3);
            
            selected.forEach(tree => {
                if (Math.random() > 0.3) {  // æˆåŠŸç‡ä»0.5æé«˜åˆ°0.7
                    tree.classList.add('super');
                    state.score += 8;  // ä»5å¢åŠ åˆ°8
                }
            });
            
            addLog(`ğŸ§ª ä½¿ç”¨è‚¥æ–™ï¼Œ${selected.length}æ£µæ ‘æœ¨æœ‰æœºä¼šè¿›åŒ–ä¸ºè¶…çº§æ¢­æ¢­`);
            updateGame();
        });

        // å‡çº§å·¥å…·
        upgradeBtn.addEventListener('click', () => {
            if (state.score < 30) {  // ä»50é™ä½åˆ°30
                addLog(`âŒ éœ€è¦30ç”Ÿæ€åˆ†æ‰èƒ½å‡çº§ (å½“å‰: ${state.score})`, 'warning');
                return;
            }
            
            state.score -= 30;  // ä»50é™ä½åˆ°30
            state.toolLevel++;
            state.maxTrees += 5;
            state.water += 3;
            
            addLog(`ğŸ› ï¸ å·¥å…·å‡çº§åˆ° ${state.toolLevel} çº§ï¼æœ€å¤§æ ‘æœ¨+5ï¼Œæµ‡æ°´+3`);
            updateGame();
        });

        // é‡æ–°å¼€å§‹
        resetBtn.addEventListener('click', () => {
            if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦å°†ä¸¢å¤±ï¼')) {
                gameArea.innerHTML = '';
                state.trees = 0;
                state.score = 0;
                state.water = 10;
                state.fertilizer = 5;
                state.toolLevel = 1;
                state.maxTrees = 30;
                state.cooldowns = { planting: false, watering: false };
                
                clearWeather();
                clearInterval(state.resourceTimer);
                
                addLog("ğŸ”„ æ¸¸æˆå·²é‡ç½®");
                updateGame();
                startWeatherEvents();
                startResourceRecovery();
            }
        });

        // ç”Ÿæˆå°é¸Ÿ
        function spawnBird() {
            const bird = document.createElement('div');
            bird.className = 'animal bird';
            bird.style.top = `${20 + Math.random() * 50}px`;
            gameArea.appendChild(bird);
            
            setTimeout(() => {
                bird.remove();
            }, 10000);
            
            addLog("ğŸ¦ ä¸€åªå°é¸Ÿè¢«å¸å¼•åˆ°ç»¿æ´²ï¼", 'warning');
        }

        // èµ„æºè‡ªåŠ¨æ¢å¤
        function startResourceRecovery() {
            state.resourceTimer = setInterval(() => {
                if (state.water < 10 + state.toolLevel) {
                    state.water++;
                    addLog("ğŸ’¦ æ¢å¤äº†1æ¬¡æµ‡æ°´æœºä¼š", 'warning');
                    updateGame();
                }
                
                // æ¯2åˆ†é’Ÿæ¢å¤1æ¬¡è‚¥æ–™
                if (Date.now() % 120000 < 1000 && state.fertilizer < 5 + state.toolLevel) {
                    state.fertilizer++;
                    addLog("ğŸ§´ æ¢å¤äº†1æ¬¡æ–½è‚¥æœºä¼š", 'warning');
                    updateGame();
                }
            }, 60000); // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
        }

        // éšæœºå¤©æ°”äº‹ä»¶
        function startWeatherEvents() {
            if (state.weatherTimer) clearTimeout(state.weatherTimer);
            
            state.weatherTimer = setTimeout(() => {
                const weatherTypes = ['sunny', 'rain', 'sandstorm'];
                const weights = [
                    0.7,
                    0.2 + (state.score / 200),
                    0.1 - (state.score / 300)
                ];
                
                const random = Math.random();
                let acc = 0;
                let selectedWeather = 'sunny';
                
                for (let i = 0; i < weatherTypes.length; i++) {
                    acc += weights[i];
                    if (random < acc) {
                        selectedWeather = weatherTypes[i];
                        break;
                    }
                }
                
                changeWeather(selectedWeather);
                startWeatherEvents();
            }, 15000 + Math.random() * 20000);
        }

        function changeWeather(type) {
            state.weather = type;
            
            switch(type) {
                case 'rain':
                    rainEffect.style.opacity = '0.3';
                    sandstormEffect.style.opacity = '0';
                    addLog("ğŸŒ§ï¸ å¼€å§‹ä¸‹é›¨äº†ï¼æ ‘æœ¨ç”Ÿé•¿åŠ å¿«", 'warning');
                    
                    state.water = Math.min(state.water + 2, 10 + state.toolLevel); // ä¸‹é›¨æ¢å¤æ›´å¤šæ°´
                    break;
                    
                case 'sandstorm':
                    sandstormEffect.style.opacity = '0.3';
                    rainEffect.style.opacity = '0';
                    addLog("ğŸŒªï¸ æ²™å°˜æš´æ¥è¢­ï¼å°å¿ƒæ ‘æœ¨å—æŸ", 'danger');
                    
                    if (Math.random() > 0.7 && state.trees > 0) {
                        const trees = document.querySelectorAll('.tree:not(.super)');
                        if (trees.length > 0) {
                            const toRemove = Math.floor(Math.random() * Math.min(3, trees.length));
                            for (let i = 0; i < toRemove; i++) {
                                trees[i].remove();
                                state.trees--;
                            }
                            addLog(`ğŸ’¨ æ²™å°˜æš´æ‘§æ¯äº† ${toRemove} æ£µæ ‘æœ¨`, 'danger');
                        }
                    }
                    break;
                    
                default:
                    clearWeather();
                    addLog("â˜€ï¸ å¤©æ°”è½¬æ™´äº†");
            }
            
            updateGame();
        }

        function clearWeather() {
            rainEffect.style.opacity = '0';
            sandstormEffect.style.opacity = '0';
            state.weather = 'sunny';
        }

        // å·¥å…·æç¤º
        function showTooltip(event, text) {
            tooltip.textContent = text;
            tooltip.style.left = `${event.pageX + 10}px`;
            tooltip.style.top = `${event.pageY - 10}px`;
            tooltip.style.opacity = '1';
        }

        function hideTooltip() {
            tooltip.style.opacity = '0';
        }

        // äº‹ä»¶æ—¥å¿—
        function addLog(message, type = 'normal') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            eventLog.appendChild(entry);
            eventLog.scrollTop = eventLog.scrollHeight;
            
            if (eventLog.children.length > 20) {
                eventLog.removeChild(eventLog.children[0]);
            }
        }

        // æ›´æ–°æ¸¸æˆçŠ¶æ€
        function updateGame() {
            treeCountEl.textContent = state.trees;
            ecoScoreEl.textContent = state.score;
            waterCountEl.textContent = state.water;
            document.getElementById('water-text').textContent = state.water;
            document.getElementById('fertilize-text').textContent = state.fertilizer;
            
            document.getElementById('tree-progress').style.width = `${(state.trees / state.maxTrees) * 100}%`;
            document.getElementById('eco-progress').style.width = `${Math.min(state.score / 100, 1) * 100}%`;
            document.getElementById('water-progress').style.width = `${(state.water / (10 + state.toolLevel)) * 100}%`;
            
            if (state.score > 50) {
                gameArea.style.background = 'linear-gradient(to bottom, #E6D5B8, #88C999)';
            } else if (state.score > 20) {
                gameArea.style.background = 'linear-gradient(to bottom, #E6D5B8, #A8D8A8)';
            } else {
                gameArea.style.background = '#E6D5B8';
            }
            
            plantBtn.disabled = state.cooldowns.planting || state.trees >= state.maxTrees;
            waterBtn.disabled = state.cooldowns.watering || state.water <= 0;
            fertilizeBtn.disabled = state.fertilizer <= 0;
            upgradeBtn.disabled = state.score < 30;  // ä»50é™ä½åˆ°30
            
            if (state.score === 15) {
                addLog("âœ¨ æ–°åŠŸèƒ½è§£é”ï¼šæ–½è‚¥å¯ä»¥åˆ›é€ è¶…çº§æ¢­æ¢­æ ‘äº†ï¼", 'warning');
            }
            
            if (state.score === 40) {
                addLog("âœ¨ æ–°åŠŸèƒ½è§£é”ï¼šå·¥å…·å‡çº§ç°åœ¨å¯æé«˜æœ€å¤§æ ‘æœ¨æ•°é‡ï¼", 'warning');
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            gameArea.innerHTML = `
                <div class="weather rain" id="rainEffect"></div>
                <div class="weather sandstorm" id="sandstormEffect"></div>
            `;
            
            rainEffect = document.getElementById('rainEffect');
            sandstormEffect = document.getElementById('sandstormEffect');
            
            updateGame();
            startWeatherEvents();
            startResourceRecovery();
            
            showTooltip({
                pageX: plantBtn.getBoundingClientRect().left + plantBtn.offsetWidth/2,
                pageY: plantBtn.getBoundingClientRect().top
            }, "ç‚¹å‡»å¼€å§‹å¿«é€Ÿç§æ¤");
            setTimeout(hideTooltip, 2000);
        }

        // å¯åŠ¨æ¸¸æˆ
        initGame();
    </script>
</body>
</html>